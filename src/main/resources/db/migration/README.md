# SQL Миграции

Этот каталог содержит SQL скрипты для создания триггеров и constraints в PostgreSQL.

## Использование

Выполните скрипты вручную в вашей БД PostgreSQL или используйте инструмент миграций (например, Flyway или Liquibase).

### V1__init_schema.sql

Содержит:
1. **Триггер предотвращения удаления** - запрещает удаление книги с `deletion_locked = true`
2. **Триггеры пересчета рейтинга** - автоматически пересчитывают `rating_avg` и `rating_count` при изменении таблицы `ratings`
3. **Constraint для рейтинга** - проверяет, что значение рейтинга находится в диапазоне 1-10

## Примечания

- Триггеры обеспечивают целостность данных на уровне БД
- Даже если в приложении есть ошибка, БД не позволит нарушить бизнес-правила

